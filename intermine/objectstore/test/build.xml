
<project name="intermine-objectstore-test" default="default" basedir="."
  xmlns:imtestsproj="http://www.intermine.org/ns/im-tests-proj/1"
  xmlns:imdbproj="http://www.intermine.org/ns/im-db-proj/1">
  
  <description>build, test, package intermine-objectstore-test</description>
  
  <import file="../../../imbuild/tests.xml"/>
  <import file="../../../imbuild/db.xml"/>
  
  <target name="-pre-test" depends="build-db-truncunittest, build-db-notxmlunittest, build-db-flatmodeunittest"/>
  
  <target name="-init-test" depends="tests.-init-test">
    <copy file="${user.home}/${intermine.properties.file}"
          tofile="${build.test.resources.dir}/intermine.properties"/>
    <copy file="${default.intermine.properties.file}"
          tofile="${build.test.resources.dir}/default.intermine.properties"/>
  </target>
   
  <target name="do-test" depends="-init-macrodef-junit">
    <imtestsproj:junit excludes="org/intermine/objectstore/webservice/**,org/intermine/util/CacheMapTest.class"/>
    <imtestsproj:junit fork="yes" includes="org/intermine/util/CacheMapTest.class">
      <customize>
        <jvmarg value="-Xmx200M"/>
      </customize>
    </imtestsproj:junit>
  </target>
  
  <target name="-define-db-classpath">
    <!-- Override to alter the classpath created -->
    <path id="db.class.path">
      <pathelement location="${build.task.dir}"/>
      <pathelement location="${build.test.resources.dir}"/>
      <path refid="main.class.path"/>
    </path>
  </target>

  <target name="build-db-truncunittest" depends="init, -init-deps, -init-db-tasks">
    <imdbproj:build-db osname="os.truncunittest"
                       dbname="db.truncunittest"
                       model="testmodel"/>
  </target>

  <target name="build-db-notxmlunittest" depends="init, -init-deps, -init-db-tasks">
    <imdbproj:build-db osname="os.notxmlunittest"
                       dbname="db.notxmlunittest"
                       model="testmodel"/>
  </target>

  <target name="build-db-flatmodeunittest" depends="init, -init-deps, -init-db-tasks">
    <imdbproj:build-db osname="os.flatmodeunittest"
                       dbname="db.flatmodeunittest"
                       model="testmodel"/>
  </target>
  
  <!-- index the unittest database -->
  <target name="create-indexes-unittest" depends="init, -init-deps, -init-db-tasks">
    <create-indexes alias="os.unittest" attributeIndexes="false"/>
  </target>

  <!-- index the truncated unittest database -->
  <target name="create-indexes-truncunittest" depends="init, -init-deps, -init-db-tasks">
    <create-indexes alias="os.truncunittest" attributeIndexes="false"/>
  </target>

  <!-- index the withNotXml unittest database -->
  <target name="create-indexes-notxmlunittest" depends="init, -init-deps, -init-db-tasks">
    <create-indexes alias="os.notxmlunittest" attributeIndexes="false"/>
  </target>

  <!-- index the flatmode unittest database -->
  <target name="create-indexes-flatmodeunittest" depends="init, -init-deps, -init-db-tasks">
    <create-indexes alias="os.flatmodeunittest" attributeIndexes="false"/>
  </target>

  <target name="create-indexes-unittest-attribute" depends="init, -init-deps, -init-db-tasks">
    <create-indexes alias="os.unittest" attributeIndexes="true"/>
  </target>
  
</project>

